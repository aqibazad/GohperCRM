@{
    var cities = new List<string> { "Karachi", "Lahore", "Faisalabad", "Rawalpindi", "Multan", "Peshawar", "Quetta", "Sargodha", "Sialkot", "Gujranwala", "Bahawalpur", "Sukkur", "Larkana", "Sheikhupura", "Gujrat", "Jhang", "Dera Ghazi Khan", "Sahiwal", "Nawabshah", "Mardan", "Mirpur Khas", "Rahim Yar Khan", "Okara", "Khanpur", "Kasur", "Chiniot", "Muzaffargarh", "Burewala", "Jhelum", "Shikarpur", "Hafizabad", "Kohat", "Mingora", "Attock", "Mandi Bahauddin", "Jacobabad", "Turbat", "Dadu", "Gojra", "Tando Allahyar", "Tando Muhammad Khan", "Kamoke", "Khushab", "Kot Addu", "Jaranwala", "Pakpattan", "Bahawalnagar", "Tando Adam", "Kandhkot", "Vihari", "Dera Ismail Khan", "Chishtian", "Hub", "Narowal", "Jalalpur Jattan", "Charsadda", "Mansehra", "Abbottabad", "Chakwal", "Khairpur", "Chiniot", "Lodhran", "Nowshera", "Swabi", "Tando Jam", "Hassan Abdal", "Daska", "Mandi Bahauddin", "Jhang Sadr", "Muzaffarabad", "Jampur", "Tando Qaisrani", "Chiniot", "Chaman", "Gwadar", "Sadiqabad", "Nankana Sahib", "Umerkot", "Kotli", "Mithi", "Skardu", "Gilgit", "Hunza", "Kalat", "Pasni", "Ormara", "Khuzdar", "Zhob", "Sibi", "Dera Murad Jamali", "Turbat", "Dera Allah Yar", "Usta Muhammad", "Harnai", "Loralai", "Mastung" }
        ; // Add your city names here
    var citiesJson = Newtonsoft.Json.JsonConvert.SerializeObject(cities);
}
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
<div class="content-wrapper">
    <div class="content-wrapper-before"></div>
    <div class="container-full">

        @if (TempData["SuccessMessage"] != null)
        {
            <script>
                // Display the success message as a popup alert
                $(document).ready(function () {
                    alert('@TempData["SuccessMessage"]');
                });
            </script>
        }
        <!-- Main content -->
        <section class="content">
            <!-- Content Header (Page header) -->
            <div class="content-header">
                <div class="d-flex align-items-center">
                    <div class="w-p100 d-md-flex align-items-center justify-content-between">
                        <h3 class="page-title">   </h3>
                        <div class="d-inline-block align-items-center">
                            <nav>
                                <ol class="breadcrumb">
                                </ol>
                            </nav>
                        </div>
                    </div>

                </div>
            </div>
            <div class="row">

                <div class="col-12">
                    <div class="box">
                        <div class="box-header with-border">
                            <h3 class="box-title">All Leads Summary</h3>
                            <h6 class="box-subtitle">Export data to Copy, CSV, Excel, PDF & Print</h6>
                            <div class="float-right">
                                
                                <div class="mb-3 d-flex justify-content-end">
                                    <a href="@Url.Action("ExportToExcel", "Lead")" class="btn btn-success  btn-block my-10 me-2"><i class="fas fa-file-excel"></i>&nbsp; Excel</a> &nbsp;
                                    <a href="@Url.Action("ExportToCSV", "Lead")" class="btn btn-info  btn-block my-10"><i class="fas fa-file-csv"></i>&nbsp; CSV</a>
                                </div>
                            </div>
                        </div>



                        <!-- /.box-header -->
                        <div class="box-body">
                            <div class="table-responsive">
                                <table id="brandTable" class="display expandable-table" style="width:100%">
                                    <thead class="thead-dark">
                                        <tr>
                                            <th style="background-color: #4e0973;color:white;"> First Name </th>
                                            <th style="background-color: #4e0973;color:white;"> Last Name </th>
                                            <th style="background-color: #4e0973;color:white;">   Gender </th>
                                            <th style="background-color: #4e0973;color:white;"> Phone Number </th>
                                            <th style="background-color: #4e0973;color:white;"> Email </th>
                                            <th style="background-color: #4e0973;color:white;"> City </th>
                                            <th style="background-color: #4e0973;color:white;"> Created Date </th>
                                            <th style="background-color: #4e0973;color:white;"> Action </th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                        <!-- /.box-body -->
                    </div>
                </div>
            </div>

        </section>

    </div>
</div>


<!-- partial -->
@* <div class="main-panel">
    <div class="content-wrapper">
        @if (TempData["SuccessMessage"] != null)
        {
            <script>
                // Display the success message as a popup alert
                $(document).ready(function () {
                    alert('@TempData["SuccessMessage"]');
                });
            </script>
        }

        <div class="row">
            <div class="col-md-12 grid-margin stretch-card">
                <div class="card">
                    <div class="card-body">
                        <p class="card-title"> All Leads</p>
                        <div class="row">
                            <div class="col-12">
                                <div class="table-responsive">
                                    <div class="mb-3 d-flex justify-content-end">
                                        <a href="@Url.Action("ExportToExcel", "Lead")" class="btn btn-success btn-sm me-2"><i class="fas fa-file-excel"></i>&nbsp; Excel</a> &nbsp;
                                        <a href="@Url.Action("ExportToCSV", "Lead")" class="btn btn-info btn-sm"><i class="fas fa-file-csv"></i>&nbsp; CSV</a>
                                    </div>

                                    <table id="brandTable" class="display expandable-table" style="width:100%">
                                        <thead class="thead-dark">
                                            <tr>
                                                <th> First Name </th>
                                                <th> Last Name </th>
                                                <th> Phone Number </th>
                                                <th> Email </th>
                                                <th> Creation Date </th>
                                                <th> Action </th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</div>
 *@
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Edit Lead</h5>
            </div>
            <div class="modal-body">
                <form id="editLeadForm">
                    <input type="hidden" id="leadId" name="leadId" />
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="firstName" class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstName" name="firstName" required />
                        </div>
                        <div class="col-md-6">
                            <label for="lastName" class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastName" name="lastName" />
                        </div>
                    </div>
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="phoneNumber" class="form-label">Phone Number</label>
                            <input type="text" class="form-control" id="phoneNumber" name="phoneNumber" required />
                        </div>
                        <div class="col-md-6">
                            <label for="email" class="form-label">Email</label>
                            <input type="email" class="form-control" id="email" name="email" />
                        </div>
                    </div> 
                    <div class="row mb-3">
                        <div class="col-md-6">
                            <label for="gender" class="form-label">Gender</label>
                            <select class="form-control" id="gender" name="gender" required>
                                <option value="Male">Male</option>
                                <option value="Female">Female</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                        <div class="col-md-6">
                            <label for="leadSource" class="form-label">Lead Source</label>
                            <select id="leadSource" class="form-control" name="leadSource">
                                <option value="">Select lead source</option>
                                <option value="Social Media">Social Media</option>
                                <option value="Website">Website</option>
                                <option value="Event">Event</option>
                                <option value="Walk in">Walk in</option>
                                <option value="Partner/Referral">Partner/Referral</option>
                                <option value="Other">Other</option>
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>City</label>
                                 <select class="form-control" id="city" name="city" required>
                                    <option value="">Select City</option>
                                    @foreach (var city in cities)
                                    {
                                        <option value="@city">@city</option>
                                    }
                                </select>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="form-group">
                                <label>Notes</label>
                                <input type="text" class="form-control" name="notes" id="notes" placeholder="Notes">
                             </div>
                        </div>
                    </div>
                    <div class="mb-3">
                        <label for="address" class="form-label">Address</label>
                        <textarea class="form-control" id="address" name="address" rows="3"></textarea>
                    </div>
                  
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                <button type="button" class="btn btn-primary" id="submitButton">Submit</button>
            </div>
        </div>
    </div>
</div>

<!-- jQuery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

<!-- Bootstrap JS -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

 
@section Scripts {
    <script>
        $(document).ready(function () {
            var table = $('#brandTable').DataTable({
                "ajax": {
                    "url": "/Admin/Lead/GetAllLeadData",
                    "type": "GET",
                    "datatype": "json"
                },
                "columns": [
                    { "data": "firstName", "autoWidth": true },
                    { "data": "lastName", "autoWidth": true },
                    { "data": "gender", "autoWidth": true },
                    { "data": "phoneNumber", "autoWidth": true },
                    { "data": "email", "autoWidth": true },
                    { "data": "city", "autoWidth": true },
                    {
                        "data": "createdDate",
                        "autoWidth": true,
                        "render": function (data) {
                            return data ? new Date(data).toDateString() : null;
                        }
                    },
                    {
                        "data": null,
                        "render": function (data, type, row) {
                            var editButton = '<a href="#" class="btn btn-primary open-modal me-3" ' +
                                'data-leadid="' + row.leadId + '" ' +
                                'data-firstname="' + row.firstName + '" ' +
                                'data-lastname="' + (row.lastName || '') + '" ' +
                                'data-phonenumber="' + row.phoneNumber + '" ' +
                                'data-email="' + (row.email || '') + '" ' +
                                'data-address="' + (row.address || '') + '" ' +
                                'data-gender="' + (row.gender || '') + '" ' +
                                'data-leadsource="' + (row.leadSource || '') + '" ' +
                                'data-city="' + (row.city || '') + '" ' +
                                'data-notes="' + (row.notes || '') + '" ' +
                                'style="padding: 12px;margin-right: 5px;">' +
                                '<i class="bi bi-pencil" style="margin-right: 5px;"></i></a>';


                            var deleteButton = '<a href="#" class="btn btn-danger delete-lead" ' +
                                'data-leadid="' + row.leadId + '" ' +
                                'data-firstname="' + row.firstName + '" ' +
                                'style="padding: 12px;">' +
                                '<i class="bi bi-trash" style="margin-right: 3px;"></i></a>';

                            return editButton + deleteButton;
                        }
                    }


                ],
                "initComplete": function () {
                    // Open modal for editing lead
                    $('#brandTable').on('click', '.open-modal', function () {
                        var leadId = $(this).data('leadid');
                        var firstName = $(this).data('firstname');
                        var lastName = $(this).data('lastname');
                        var phoneNumber = $(this).data('phonenumber');
                        var email = $(this).data('email');
                        var address = $(this).data('address');
                        var gender = $(this).data('gender');  // Add this line
                        var leadSource = $(this).data('leadsource');  // Add this line
                        var city = $(this).data('city');  // Add this line
                        var notes = $(this).data('notes');  // Add this line


                        // Populate modal fields
                        $('#leadId').val(leadId);
                        $('#firstName').val(firstName);
                        $('#lastName').val(lastName);
                        $('#phoneNumber').val(phoneNumber);
                        $('#email').val(email);
                        $('#address').val(address);
                        $('#gender').val(gender);  // Add this line
                        $('#leadSource').val(leadSource);  // Add this line
                        $('#city').val(city);  // Add this line
                        $('#notes').val(notes);  // Add this line

                        // Show the modal
                        $('#myModal').modal('show');
                    });

                    // Submit edited lead data
                    $('#submitButton').on('click', function () {
                        var leadId = $('#leadId').val();
                        var firstName = $('#firstName').val();
                        var lastName = $('#lastName').val();
                        var phoneNumber = $('#phoneNumber').val();
                        var email = $('#email').val();
                        var address = $('#address').val();
                        var gender = $('#gender').val();  // Add this line
                        var leadSource = $('#leadSource').val();  // Add this line
                        var city = $('#city').val();  // Add this line
                        var notes = $('#notes').val();  // Add this line

                        var data = {
                            LeadId: leadId,
                            FirstName: firstName,
                            LastName: lastName,
                            PhoneNumber: phoneNumber,
                            Email: email,
                            Address: address,
                            Gender: gender,  // Add this line
                            LeadSource: leadSource ,
                            City: city ,
                            Notes: notes ,
                        };

                        $.ajax({
                            url: '/Admin/Lead/EditLead', // Replace with your action method URL
                            type: 'POST',
                            contentType: 'application/json',
                            data: JSON.stringify(data),
                            success: function (response) {
                                console.log('Server response:', response);

                                if (response.success) {
                                    $('#myModal').modal('hide');
                                    alert(response.message);
                                    table.ajax.reload();
                                } else {
                                    alert('Failed to update lead: ' + response.message);
                                }
                            },
                            error: function (xhr, status, error) {
                                console.error('Error updating lead:', error);
                            }
                        });
                    });

                    // Delete lead
                    $('#brandTable').on('click', '.delete-lead', function () {
                        var leadId = $(this).data('leadid');
                        var firstName = $(this).data('firstname');

                        if (confirm('Are you sure you want to delete ' + firstName + '?')) {
                            $.ajax({
                                url: '/Admin/Lead/DeleteLead', // Replace with your action method URL
                                type: 'POST',
                                contentType: 'application/json',
                                data: JSON.stringify({ LeadId: leadId }),
                                success: function (response) {
                                    console.log('Server response:', response);

                                    if (response.success) {
                                        alert(response.message);
                                        table.ajax.reload();
                                    } else {
                                        alert('Failed to delete lead: ' + response.message);
                                    }
                                },
                                error: function (xhr, status, error) {
                                    console.error('Error deleting lead:', error);
                                }
                            });
                        }
                    });
                }
            });

            // Hide the 'Show entries' dropdown
            $('.dataTables_length').hide();
        });
    </script>
}
